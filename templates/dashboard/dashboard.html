{% extends "login_base.html" %}
{% block title %}Competitor Tracking - FusionHub{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-gray-800 mb-8">ðŸ“¦ Competitor Tracking</h1>

<!-- Top Metrics -->
<div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <div class="p-6 bg-white rounded-lg shadow text-center">
    <h2 class="text-sm text-gray-500">Total Competitors</h2>
    <p class="text-3xl font-bold text-primary-600">5</p>
  </div>
  <div class="p-6 bg-white rounded-lg shadow text-center">
    <h2 class="text-sm text-gray-500">Auto-Discovered</h2>
    <p class="text-3xl font-bold text-green-600">3</p>
  </div>
  <div class="p-6 bg-white rounded-lg shadow text-center">
    <h2 class="text-sm text-gray-500">Manual Added</h2>
    <p class="text-3xl font-bold text-blue-600">2</p>
  </div>
  <div class="p-6 bg-white rounded-lg shadow text-center">
    <h2 class="text-sm text-gray-500">Price Changes (24h)</h2>
    <p class="text-3xl font-bold text-yellow-500">4</p>
  </div>
</div>

<!-- Filters: Product + Platform -->
<div class="mb-6 flex gap-6">
  <!-- Product Dropdown -->
  <div>
    <label for="productSelect" class="block text-sm font-medium text-gray-700 mb-2">
      Select Product
    </label>
    <select id="productSelect" class="w-64 px-3 py-2 border rounded-lg focus:ring focus:ring-indigo-500"
            hx-get="" 
            hx-target="#productComparison" hx-trigger="change">
      <option value="diaper_m">SuperBaby Diaper - Size M</option>
      <option value="diaper_l">SuperBaby Diaper - Size L</option>
      <option value="wipes_100">Baby Wipes 100pcs</option>
    </select>
  </div>

  <!-- Platform Dropdown -->
  <div>
    <label for="platformSelect" class="block text-sm font-medium text-gray-700 mb-2">
      Filter by Platform
    </label>
    <select id="platformSelect" class="w-64 px-3 py-2 border rounded-lg focus:ring focus:ring-indigo-500"
            hx-get="" 
            hx-target="#productComparison" hx-trigger="change">
      <option value="all">All Platforms</option>
      <option value="amazon">Amazon</option>
      <option value="flipkart">Flipkart</option>
      <option value="myntra">Myntra</option>
    </select>
  </div>
</div>

<!-- Product Comparison Section (HTMX Target) -->
<div id="productComparison">
  <!-- Charts -->
  <div class="grid lg:grid-cols-2 gap-8 mb-8">
    <div class="p-6 bg-white rounded-lg shadow">
      <h2 class="text-lg font-semibold mb-4">ðŸ“Š Price Trends</h2>
      <div class="h-64">
        <canvas id="priceTrendChart"></canvas>
      </div>
    </div>
    <div class="p-6 bg-white rounded-lg shadow">
      <h2 class="text-lg font-semibold mb-4">ðŸ¥§ Market Share</h2>
      <div class="h-64">
        <canvas id="marketShareChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Recent Alerts Table -->
  <div class="p-6 bg-white rounded-lg shadow">
    <h2 class="text-lg font-semibold mb-4">ðŸ”” Recent Competitor Alerts</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-100 text-gray-600">
            <th class="px-4 py-2">Product</th>
            <th class="px-4 py-2">Competitor</th>
            <th class="px-4 py-2">Platform</th>
            <th class="px-4 py-2">Old Price</th>
            <th class="px-4 py-2">New Price</th>
            <th class="px-4 py-2">Date</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-t">
            <td class="px-4 py-2">SuperBaby Diaper - Size M</td>
            <td class="px-4 py-2">Pampers</td>
            <td class="px-4 py-2">Amazon</td>
            <td class="px-4 py-2">â‚¹450</td>
            <td class="px-4 py-2 text-green-600">â‚¹430</td>
            <td class="px-4 py-2">Today</td>
          </tr>
          <tr class="border-t">
            <td class="px-4 py-2">SuperBaby Diaper - Size M</td>
            <td class="px-4 py-2">Huggies</td>
            <td class="px-4 py-2">Flipkart</td>
            <td class="px-4 py-2">â‚¹460</td>
            <td class="px-4 py-2 text-red-600">â‚¹470</td>
            <td class="px-4 py-2">Yesterday</td>
          </tr>
          <tr class="border-t">
            <td class="px-4 py-2">SuperBaby Diaper - Size M</td>
            <td class="px-4 py-2">MamyPoko</td>
            <td class="px-4 py-2">Myntra</td>
            <td class="px-4 py-2">â‚¹455</td>
            <td class="px-4 py-2 text-green-600">â‚¹450</td>
            <td class="px-4 py-2">Today</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Line Chart - Price Trends
const ctx1 = document.getElementById('priceTrendChart').getContext('2d');
new Chart(ctx1, {
  type: 'line',
  data: {
    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
    datasets: [
      { label: 'Pampers (Amazon)', data: [450, 440, 430, 435, 430, 430, 430], borderColor: '#3b82f6', fill: false },
      { label: 'Huggies (Flipkart)', data: [460, 462, 465, 468, 470, 470, 470], borderColor: '#f59e0b', fill: false },
      { label: 'MamyPoko (Myntra)', data: [455, 454, 452, 451, 450, 450, 450], borderColor: '#10b981', fill: false }
    ]
  },
  options: { responsive: true, maintainAspectRatio: false }
});

// Pie Chart - Market Share
const ctx2 = document.getElementById('marketShareChart').getContext('2d');
new Chart(ctx2, {
  type: 'doughnut',
  data: {
    labels: ['Pampers', 'Huggies', 'MamyPoko'],
    datasets: [{
      data: [35, 40, 25],
      backgroundColor: ['#3b82f6', '#f59e0b', '#10b981']
    }]
  },
  options: { responsive: true, maintainAspectRatio: false }
});
</script>
{% endblock %}
